{"version":3,"file":"author-control.min.js","sources":["../src/element.js"],"sourcesContent":["class AuthorFormControlElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineAttributes({\n      type: ''\n    })\n\n    this.UTIL.defineProperties({\n      initialValue: {\n        default: null\n      },\n\n      input: {\n        private: true\n      },\n\n      fieldInputTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'color',\n          'date',\n          'datetime-local',\n          'email',\n          'file',\n          'hidden',\n          'image',\n          'month',\n          'number',\n          'password',\n          'range',\n          'reset',\n          'search',\n          'submit',\n          'tel',\n          'text',\n          'time',\n          'url',\n          'week',\n          'textarea'\n        ]\n      },\n\n      toggleInputTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'checkbox',\n          'radio'\n        ],\n      },\n\n      supportedTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'field',\n          'toggle',\n          'select'\n        ]\n      }\n    })\n\n    this.UTIL.definePrivateMethods({\n      initDatalist: (input, datalist) => {\n        this.type = 'select'\n\n        if (!customElements.get('author-datalist')) {\n          console.dir(input);\n          input.id = this.PRIVATE.guid\n          datalist.id = `${input.id}_datalist`\n          input.setAttribute('list', datalist.id)\n          input.slot = input.slot || 'input'\n          // select.setAttribute('role', 'menu')\n          this.PRIVATE.input = input\n\n          let titleEls = datalist.querySelectorAll('option[title]')\n          titleEls.forEach(el => select.removeChild(el))\n\n          Array.from(datalist.options).forEach(option => {\n            if (option.hasAttribute('label') && option.getAttribute('label').trim() === '') {\n              option.removeAttribute('label')\n            }\n          })\n\n          return\n        }\n\n        let surrogate = document.createElement('author-datalist')\n        surrogate.slot = 'input'\n\n        Array.from(datalist.attributes).forEach(attr => {\n          if (attr.specified) {\n            surrogate.setAttribute(attr.name, attr.value)\n\n            if (attr.name === 'autofocus') {\n              datalist.removeAttribute(attr.name)\n            }\n          }\n        })\n\n        this.removeChild(datalist)\n        this.removeChild(input)\n\n        surrogate.inject(input, datalist, this.PRIVATE.guid)\n        this.appendChild(surrogate)\n        this.PRIVATE.input = surrogate\n      },\n\n      initInput: input => {\n        input.slot = input.slot || 'input'\n        this.PRIVATE.input = input\n        input.id = this.PRIVATE.guid\n        this.initialValue = input.value\n\n        if (this.PRIVATE.fieldInputTypes.indexOf(input.type) >= 0) {\n          this.type = 'field'\n        }\n\n        if (this.PRIVATE.toggleInputTypes.indexOf(input.type) >= 0) {\n          this.type = 'toggle'\n        }\n      },\n\n      initLabel: label => {\n        this.label = label\n        label.slot = label.slot || 'label'\n        label.htmlFor = this.PRIVATE.guid\n\n        if (this.type === 'select') {\n          this.label.addEventListener('click', (evt) => {\n            this.input.focus()\n          })\n        }\n      },\n\n      initDefaultSelect: select => {\n        select.id = this.PRIVATE.guid\n        select.slot = select.slot || 'input'\n        select.setAttribute('role', 'menu')\n        this.PRIVATE.input = select\n\n        // Purge incompatible attributes\n        let titleEls = select.querySelectorAll('option[title]')\n        titleEls.forEach(el => select.removeChild(el))\n\n        Array.from(select.options).forEach(option => {\n          if (option.hasAttribute('label') && option.getAttribute('label').trim() === '') {\n            option.removeAttribute('label')\n          }\n        })\n      },\n\n      initMultipleSelectMenu: select => {\n        this.type = 'select'\n        this.initialValue = select.selectedOptions\n\n        if (!customElements.get('author-select')) {\n          return this.PRIVATE.initDefaultSelect(select)\n        }\n\n        this.PRIVATE.initSelectSurrogate(select, document.createElement('author-select'))\n      },\n\n      initSelectSurrogate: (original, surrogate) => {\n        surrogate.slot = 'input'\n        surrogate.id = this.PRIVATE.guid\n\n        Array.from(original.attributes).forEach(attr => {\n          if (attr.specified) {\n            surrogate.setAttribute(attr.name, attr.value)\n\n            if (attr.name === 'autofocus') {\n              original.removeAttribute(attr.name)\n            }\n          }\n        })\n\n        this.removeChild(original)\n        surrogate.inject(original, this.querySelectorAll('label'))\n\n        this.appendChild(surrogate)\n        this.PRIVATE.input = surrogate\n      },\n\n      initSelectMenu: select => {\n        this.type = 'select'\n        this.initialValue = select.selectedIndex\n\n        if (!customElements.get('author-select')) {\n          return this.PRIVATE.initDefaultSelect(select)\n        }\n\n        this.PRIVATE.initSelectSurrogate(select, document.createElement('author-select'))\n      },\n\n      transformChild: (node, index, collection) => {\n        switch (node.nodeName) {\n          case 'LABEL':\n            return this.PRIVATE.initLabel(node)\n\n          case 'INPUT':\n            // Check if there is an additional element adjacent to the input\n            if (collection[index + 1] === void 0) {\n              return this.PRIVATE.initInput(node)\n            }\n\n            let adjacentElement = collection[index + 1].addedNodes.item(0);\n\n            if (!adjacentElement || adjacentElement.nodeName !== 'DATALIST') {\n              return this.PRIVATE.initInput(node)\n            }\n\n            return this.PRIVATE.initDatalist(node, adjacentElement)\n\n          case 'TEXTAREA':\n            return this.PRIVATE.initInput(node)\n\n          case 'SELECT':\n            if (!node.multiple) {\n              return this.PRIVATE.initSelectMenu(node)\n            }\n\n            return this.PRIVATE.initMultipleSelectMenu(node)\n\n          default:\n            this.initialValue = node.value;\n            return\n        }\n      }\n    })\n\n    this.UTIL.monitorChildren((mutations, observer) => {\n      let filtered = mutations.filter(record => {\n        let node = record.addedNodes.item(0)\n\n        if (!node) {\n          return false\n        }\n\n        return node.nodeType !== 3\n      })\n\n      filtered.forEach((record, index, array) => {\n        let node = record.addedNodes.item(0)\n\n        if (!node) {\n          return\n        }\n\n        this.PRIVATE.transformChild(node, index, array)\n      })\n\n      observer.disconnect()\n    })\n\n    this.UTIL.registerListeners(this, {\n      connected: () => this.PRIVATE.guid = this.UTIL.generateGuid('control_'),\n      rendered: () => Array.from(this.children).forEach((child, index, array) => this.PRIVATE.transformChild(child, index, array))\n    })\n  }\n\n  static get observedAttributes () {\n    return ['disabled']\n  }\n\n  get input () {\n    return this.PRIVATE.input\n  }\n\n  set input (input) {\n    if (this.input) {\n      return console.warn(`Setting <${this.localName}> child input programmatically is not allowed.`)\n    }\n\n    this.PRIVATE.input = input\n  }\n}\n\ncustomElements.define('author-control', AuthorFormControlElement)\n\nexport default AuthorFormControlElement\n"],"names":["AuthorFormControlElement","AuthorBaseElement","HTMLElement","[object Object]","super","this","UTIL","defineAttributes","type","defineProperties","initialValue","default","input","private","fieldInputTypes","readonly","toggleInputTypes","supportedTypes","definePrivateMethods","initDatalist","datalist","customElements","get","console","dir","id","PRIVATE","guid","setAttribute","slot","querySelectorAll","forEach","el","select","removeChild","Array","from","options","option","hasAttribute","getAttribute","trim","removeAttribute","surrogate","document","createElement","attributes","attr","specified","name","value","inject","appendChild","initInput","indexOf","initLabel","label","htmlFor","addEventListener","evt","focus","initDefaultSelect","initMultipleSelectMenu","selectedOptions","initSelectSurrogate","original","initSelectMenu","selectedIndex","transformChild","node","index","collection","nodeName","adjacentElement","addedNodes","item","multiple","monitorChildren","mutations","observer","filter","record","nodeType","array","disconnect","registerListeners","connected","generateGuid","rendered","children","child","observedAttributes","warn","localName","define"],"mappings":"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"}