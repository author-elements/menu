{"version":3,"file":"author-control.es5.js","sources":["../src/element.js"],"sourcesContent":["class AuthorFormControlElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineAttributes({\n      type: ''\n    })\n\n    this.UTIL.defineProperties({\n      initialValue: {\n        default: null\n      },\n\n      input: {\n        private: true\n      },\n\n      fieldInputTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'color',\n          'date',\n          'datetime-local',\n          'email',\n          'file',\n          'hidden',\n          'image',\n          'month',\n          'number',\n          'password',\n          'range',\n          'reset',\n          'search',\n          'submit',\n          'tel',\n          'text',\n          'time',\n          'url',\n          'week',\n          'textarea'\n        ]\n      },\n\n      toggleInputTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'checkbox',\n          'radio'\n        ],\n      },\n\n      supportedTypes: {\n        readonly: true,\n        private: true,\n        default: [\n          'field',\n          'toggle',\n          'select'\n        ]\n      }\n    })\n\n    this.UTIL.definePrivateMethods({\n      initDatalist: (input, datalist) => {\n        this.type = 'select'\n\n        if (!customElements.get('author-datalist')) {\n          input.id = this.PRIVATE.guid\n          datalist.id = `${input.id}_datalist`\n          input.setAttribute('list', datalist.id)\n          input.slot = input.slot || 'input'\n          // select.setAttribute('role', 'menu')\n          this.PRIVATE.input = input\n\n          let titleEls = datalist.querySelectorAll('option[title]')\n          titleEls.forEach(el => select.removeChild(el))\n\n          Array.from(datalist.options).forEach(option => {\n            if (option.hasAttribute('label') && option.getAttribute('label').trim() === '') {\n              option.removeAttribute('label')\n            }\n          })\n\n          return\n        }\n\n        let surrogate = document.createElement('author-datalist')\n        surrogate.slot = 'input'\n\n        Array.from(datalist.attributes).forEach(attr => {\n          if (attr.specified) {\n            surrogate.setAttribute(attr.name, attr.value)\n\n            if (attr.name === 'autofocus') {\n              datalist.removeAttribute(attr.name)\n            }\n          }\n        })\n\n        this.removeChild(datalist)\n        this.removeChild(input)\n\n        // Use a select as sourceElement to preserve option indexes, since\n        // datalist doesn't assign indexes to child options\n        let select = document.createElement('select')\n        Array.from(datalist.children).forEach(option => select.add(option))\n        select.selectedIndex = -1\n\n        surrogate.inject(input, select, this.PRIVATE.guid)\n        this.appendChild(surrogate)\n        this.PRIVATE.input = surrogate\n      },\n\n      initInput: input => {\n        input.slot = input.slot || 'input'\n        this.PRIVATE.input = input\n        input.id = this.PRIVATE.guid\n        this.initialValue = input.value\n\n        if (this.PRIVATE.fieldInputTypes.indexOf(input.type) >= 0) {\n          this.type = 'field'\n        }\n\n        if (this.PRIVATE.toggleInputTypes.indexOf(input.type) >= 0) {\n          this.type = 'toggle'\n        }\n      },\n\n      initLabel: label => {\n        this.label = label\n        label.slot = label.slot || 'label'\n        label.htmlFor = this.PRIVATE.guid\n\n        if (this.type === 'select') {\n          this.label.addEventListener('click', (evt) => {\n            this.input.focus()\n          })\n        }\n      },\n\n      initDefaultSelect: select => {\n        select.id = this.PRIVATE.guid\n        select.slot = select.slot || 'input'\n        select.setAttribute('role', 'menu')\n        this.PRIVATE.input = select\n\n        // Purge incompatible attributes\n        let titleEls = select.querySelectorAll('option[title]')\n        titleEls.forEach(el => select.removeChild(el))\n\n        Array.from(select.options).forEach(option => {\n          if (option.hasAttribute('label') && option.getAttribute('label').trim() === '') {\n            option.removeAttribute('label')\n          }\n        })\n      },\n\n      initMultipleSelectMenu: select => {\n        this.type = 'select'\n        this.initialValue = select.selectedOptions\n\n        if (!customElements.get('author-select')) {\n          return this.PRIVATE.initDefaultSelect(select)\n        }\n\n        this.PRIVATE.initSelectSurrogate(select, document.createElement('author-select'))\n      },\n\n      initSelectSurrogate: (original, surrogate) => {\n        surrogate.slot = 'input'\n        surrogate.id = this.PRIVATE.guid\n\n        Array.from(original.attributes).forEach(attr => {\n          if (attr.specified) {\n            surrogate.setAttribute(attr.name, attr.value)\n\n            if (attr.name === 'autofocus') {\n              original.removeAttribute(attr.name)\n            }\n          }\n        })\n\n        this.removeChild(original)\n        surrogate.inject(original, this.querySelectorAll('label'))\n\n        this.appendChild(surrogate)\n        this.PRIVATE.input = surrogate\n      },\n\n      initSelectMenu: select => {\n        this.type = 'select'\n        this.initialValue = select.selectedIndex\n\n        if (!customElements.get('author-select')) {\n          return this.PRIVATE.initDefaultSelect(select)\n        }\n\n        this.PRIVATE.initSelectSurrogate(select, document.createElement('author-select'))\n      },\n\n      transformChild: (node, index, collection) => {\n        switch (node.nodeName) {\n          case 'LABEL':\n            return this.PRIVATE.initLabel(node)\n\n          case 'INPUT':\n            // Check if there is an additional element adjacent to the input\n            if (collection[index + 1] === void 0) {\n              return this.PRIVATE.initInput(node)\n            }\n\n            let adjacentElement = collection[index + 1];\n\n            if (!adjacentElement || adjacentElement.nodeName !== 'DATALIST') {\n              return this.PRIVATE.initInput(node)\n            }\n\n            return this.PRIVATE.initDatalist(node, adjacentElement)\n\n          case 'TEXTAREA':\n            return this.PRIVATE.initInput(node)\n\n          case 'SELECT':\n            if (!node.multiple) {\n              return this.PRIVATE.initSelectMenu(node)\n            }\n\n            return this.PRIVATE.initMultipleSelectMenu(node)\n\n          default:\n            this.initialValue = node.value;\n            return\n        }\n      }\n    })\n\n    this.UTIL.monitorChildren((mutations, observer) => {\n      let filtered = mutations.filter(record => {\n        let node = record.addedNodes.item(0)\n\n        if (!node) {\n          return false\n        }\n\n        return node.nodeType !== 3\n      })\n\n      filtered.forEach((record, index, array) => {\n        let node = record.addedNodes.item(0)\n\n        if (!node) {\n          return\n        }\n\n        this.PRIVATE.transformChild(node, index, array.map(mutation => mutation.addedNodes.item(0)))\n      })\n\n      observer.disconnect()\n    })\n\n    this.UTIL.registerListeners(this, {\n      connected: () => this.PRIVATE.guid = this.UTIL.generateGuid('control_'),\n      rendered: () => Array.from(this.children).forEach((child, index, array) => this.PRIVATE.transformChild(child, index, array))\n    })\n  }\n\n  static get observedAttributes () {\n    return ['disabled']\n  }\n\n  get input () {\n    return this.PRIVATE.input\n  }\n\n  set input (input) {\n    if (this.input) {\n      return console.warn(`Setting <${this.localName}> child input programmatically is not allowed.`)\n    }\n\n    this.PRIVATE.input = input\n  }\n}\n\ncustomElements.define('author-control', AuthorFormControlElement)\n\nexport default AuthorFormControlElement\n"],"names":["super","this","let"],"mappings":"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"}